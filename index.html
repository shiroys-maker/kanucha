<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>患者フォーム</title>
</head>
<body>
  <h2>新規登録</h2>
  <form id="form">
    ID: <input name="id" required><br>
    名前: <input name="name"><br>
    生年月日: <input name="birthdate" type="date"><br>
    性別: <select name="gender"><option>男性</option><option>女性</option></select><br>
    受診日: <input name="visit" type="date"><br>
    血圧: <input name="bp"><br>
    脈: <input name="pulse"><br>
    体温: <input name="temp"><br>
    SAT: <input name="sat"><br>
    来院の目的: <textarea name="purpose"></textarea><br>
    既往歴: <textarea name="history"></textarea><br>
    内服薬: <textarea name="medication"></textarea><br>
    アレルギー: <textarea name="allergy"></textarea><br>
    診察所見: <textarea name="findings"></textarea><br>
    診断名: <textarea name="diagnosis"></textarea><br>
    投薬内容: <textarea name="prescription"></textarea><br>
    備考: <textarea name="remarks"></textarea><br>
    <button type="submit">送信</button>
  </form>

  <hr>
  <h2>患者一覧</h2>
  <ul id="patientList"></ul>

  <script>
    const apiUrl = "https://script.google.com/macros/s/AKfycbxsNR0rK2PVZRyRC3wflmTwEZ-QLJROfU2UIR8Mura1UzeQ1pvV-A3xF0qxS742U-gl4w/exec"; // ← あなたのGASのexec URLに置き換え

    document.getElementById("form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(e.target).entries());

      const res = await fetch(apiUrl, {
        method: "POST",
        body: JSON.stringify(data)
      });

      const json = await res.json();
      if (json.result === "success") {
        alert("登録完了");
        e.target.reset();
        loadPatients();
      }
    });

    async function loadPatients() {
      const res = await fetch(apiUrl);
      const patients = await res.json();
      const list = document.getElementById("patientList");
      list.innerHTML = "";
      patients.forEach(p => {
        const li = document.createElement("li");
        li.textContent = `${p.id} - ${p.name} (${p.age}歳, ${p.visit})`;
        list.appendChild(li);
      });
    }

    loadPatients();
  </script>
</body>
</html>
